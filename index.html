<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wizard - Elevate your Discord community with powerful automation</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <img src="logo.png" alt="Logo" class="nav-logo">
                <span class="nav-title">Wizard</span>
            </div>
            <div class="nav-links">
                <div class="nav-dropdown">
                    <a href="#" class="dropdown-trigger" onclick="toggleNavDropdown()">
                        Commands <i class="fas fa-chevron-down"></i>
                    </a>
                    <div class="nav-dropdown-menu" id="navDropdown">
                        <a href="jail-commands.html">
                            <i class="fas fa-lock"></i> Jail System
                        </a>
                        <a href="antinuke-commands.html">
                            <i class="fas fa-shield-alt"></i> AntiNuke
                        </a>
                        <a href="automod-commands.html">
                            <i class="fas fa-robot"></i> AutoMod
                        </a>
                        <a href="voicemaster-commands.html">
                            <i class="fas fa-microphone"></i> Voice Master
                        </a>
                        <a href="vanity-commands.html">
                            <i class="fas fa-crown"></i> Vanity & Booster
                        </a>
                        <a href="joinrole-commands.html">
                            <i class="fas fa-user-plus"></i> Join Role
                        </a>
                        <a href="giveaway-commands.html">
                            <i class="fas fa-gift"></i> Giveaway
                        </a>
                        <a href="ticket-commands.html">
                            <i class="fas fa-ticket-alt"></i> Ticket System
                        </a>
                        <a href="moderation-commands.html">
                            <i class="fas fa-gavel"></i> Moderation
                        </a>
                        <a href="rolemanagement-commands.html">
                            <i class="fas fa-users"></i> Role Management
                        </a>
                        <a href="embed-commands.html">
                            <i class="fas fa-link"></i> Embed System
                        </a>
                        <a href="welcome-commands.html">
                            <i class="fas fa-user-plus"></i> Welcome System
                        </a>
                    </div>
                </div>
                <a href="spotify.html">Spotify</a>
                <a href="documentation.html">Documentation</a>
                <a href="status.html">Status</a>
            </div>
            <div class="nav-auth">
                <!-- Login Button (shown when not logged in) -->
                <button class="login-btn" id="loginBtn" onclick="redirectToBotAuth()">
                    <i class="fab fa-discord"></i>
                    Login with Discord
                </button>
                
                <!-- User Profile (shown when logged in) -->
                <div class="user-profile" id="userProfile" style="display: none;">
                    <div class="user-avatar">
                        <img id="userAvatar" src="" alt="User Avatar">
                    </div>
                    <div class="user-info">
                        <span class="username" id="userDisplayName">Username</span>
                        <button class="logout-btn" id="logoutBtn">Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-container">
            <div class="hero-content">
                <h1 class="hero-title">
                    Elevate your community with <span>ai enable</span>
                </h1>
                <p class="hero-description">
                    Take control of your Discord server with advanced moderation, antinuke protection, and engagement tools. Automate the tedious tasks and focus on what matters - your community.
                </p>
                <div class="hero-buttons">
                    <a href="https://discord.com/oauth2/authorize?client_id=897289331075612693&permissions=8&scope=bot%20applications.commands" class="btn btn-primary">
                        <i class="fas fa-external-link-alt"></i>
                        Add to Discord
                    </a>
                    <a href="commands-web.html" class="btn btn-secondary">
                        <i class="fas fa-book"></i>
                        View Commands
                    </a>
                    <a href="https://discord.gg/PMP6Af9F" class="btn btn-support" target="_blank" rel="noopener noreferrer">
                        <i class="fab fa-discord"></i>
                        Join Support
                    </a>
                </div>
            </div>
                            <div class="hero-demo">
                    <div class="discord-panel">
                        <div class="panel-header">
                            <img src="logo.png" alt="Logo" class="panel-logo">
                            <span>Protected Server</span>
                            <div class="status-badge">
                                <i class="fas fa-check-circle"></i>
                                <span>Active</span>
                            </div>
                        </div>
                    <div class="channels">
                        <div class="channel">
                            <i class="fas fa-hashtag"></i>
                            <span>rules</span>
                        </div>
                        <div class="channel active">
                            <i class="fas fa-hashtag"></i>
                            <span>commands</span>
                            <span class="active-tag">Active</span>
                        </div>
                    </div>
                    <div class="chat-messages">
                        <div class="message bot-message">
                            <div class="message-avatar bot-avatar">
                                <img src="logo.png" alt="Bot Avatar" class="bot-avatar-img">
                            </div>
                            <div class="message-content">
                                <div class="message-header">
                                    <span class="username">wizard BOT</span>
                                    <span class="bot-tag">BOT</span>
                                    <span class="timestamp">Today at 9:00 PM</span>
                                </div>
                                <div class="message-text">
                                    ✨ @nyx: Finished setting up the AntiNuke system.
                                </div>
                            </div>
                        </div>
                        <div class="message user-message">
                            <div class="message-avatar user-avatar">
                                <img src="user-pfp.png" alt="User Avatar" class="user-avatar-img">
                            </div>
                            <div class="message-content">
                                <div class="message-header">
                                    <span class="username">nyx</span>
                                    <span class="timestamp">Today at 9:01 PM</span>
                                </div>
                                <div class="message-text">
                                    !antinuke enable
                                </div>
                            </div>
                        </div>
                        <div class="message bot-message">
                            <div class="message-avatar bot-avatar">
                                <img src="logo.png" alt="Bot Avatar" class="bot-avatar-img">
                            </div>
                            <div class="message-content">
                                <div class="message-header">
                                    <span class="username">wizard BOT</span>
                                    <span class="bot-tag">BOT</span>
                                    <span class="timestamp">Today at 9:01 PM</span>
                                </div>
                                <div class="message-text">
                                    ✨ @nyx: AntiNuke system enabled! Your server is now protected against raids and unauthorized actions.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Stats Section -->
    <section class="stats">
        <div class="stats-container">
            <p class="stats-text">
                Powering <strong>571,980</strong> users across <strong>345</strong> communities
            </p>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features" id="commands">
        <div class="container">
            <h2 class="section-title">Bot Features</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h3>AntiNuke Protection</h3>
                    <p>Advanced protection against server raids, mass actions, and unauthorized administrative changes.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-gavel"></i>
                    </div>
                    <h3>Moderation Tools</h3>
                    <p>Comprehensive moderation commands including jail system, automod, and role management.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-ticket-alt"></i>
                    </div>
                    <h3>Ticket System</h3>
                    <p>Automated ticket creation and management for user support and inquiries.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-gift"></i>
                    </div>
                    <h3>Giveaway System</h3>
                    <p>Easy-to-use giveaway creation and management with slash commands.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-microphone"></i>
                    </div>
                    <h3>Voice Master</h3>
                    <p>Advanced voice channel management and temporary voice channels.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <h3>AI Integration</h3>
                    <p>Premium AI-powered features for enhanced server interaction and automation.</p>
                </div>
            </div>
        </div>
    </section>



    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <div class="logo-circle">
                        <img src="logo.png" alt="Logo" class="logo-image">
                    </div>
                    <span>Wizard</span>
                </div>
                <div class="footer-links">
                    <a href="#commands">Commands</a>
                    <a href="documentation.html">Documentation</a>
                    <a href="https://discord.gg/PMP6Af9F" target="_blank">Support</a>
                    <a href="https://discord.com/privacy" target="_blank">Privacy</a>
                </div>
                <div class="footer-social">
                    <a href="https://discord.gg/PMP6Af9F" class="social-link" target="_blank">
                        <i class="fab fa-discord"></i>
                    </a>
                    <a href="https://github.com/Nyxnmor" class="social-link" target="_blank">
                        <i class="fab fa-github"></i>
                    </a>
                    <a href="https://x.com/Nyxnmor" class="social-link" target="_blank">
                        <i class="fab fa-twitter"></i>
                    </a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Wizard Bot. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        // Handle Discord OAuth callback on main page
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            const state = urlParams.get('state');
            const error = urlParams.get('error');

            // If we have OAuth parameters, handle the callback
            if (code || error) {
                handleDiscordCallback(code, state, error);
            } else {
                // Check if user is already logged in
                checkExistingAuth();
            }
            
            // Add logout button event listener
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', logout);
            }
        });

        function checkExistingAuth() {
            const userData = localStorage.getItem('discord_user_data');
            if (userData) {
                try {
                    const user = JSON.parse(userData);
                    updateUserProfile(user);
                    console.log('Restored user profile from localStorage');
                } catch (error) {
                    console.error('Error parsing user data:', error);
                    localStorage.removeItem('discord_user_data');
                }
            }
        }

        function logout() {
            // Clear user data
            localStorage.removeItem('discord_user_data');
            
            // Hide user profile, show login button
            const loginBtn = document.getElementById('loginBtn');
            const userProfile = document.getElementById('userProfile');
            
            if (loginBtn && userProfile) {
                loginBtn.style.display = 'flex';
                userProfile.style.display = 'none';
            }
            
            console.log('User logged out');
        }

        async function handleDiscordCallback(code, state, error) {
            if (error) {
                console.error('Discord OAuth error:', error);
                showAuthError(error);
                return;
            }

            if (!code || !state) {
                console.error('Missing OAuth parameters');
                showAuthError('Invalid authorization request');
                return;
            }

            try {
                // Show loading state
                showAuthLoading();

                // Exchange code for user data using Discord API directly
                console.log('OAuth Code:', code);
                console.log('OAuth State:', state);
                
                // Send to secure backend proxy for token exchange
                const response = await fetch('https://your-backend-domain.com/api/discord/exchange', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        code: code,
                        state: state,
                        redirect_uri: 'https://wizardspell.netlify.app/'
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();

                if (result.success) {
                    console.log('User info received:', result.user);
                    
                    // Store user data
                    localStorage.setItem('discord_user_data', JSON.stringify(result.user));
                    
                    // Show success and update UI
                    showAuthSuccess(result.user);
                    
                    // Clean up URL parameters
                    window.history.replaceState({}, document.title, window.location.pathname);
                } else {
                    throw new Error(result.error || 'Authentication failed');
                }
            } catch (error) {
                console.error('Authentication error:', error);
                showAuthError('Failed to complete authentication');
            }
        }

        function showAuthLoading() {
            // You can add a loading overlay here if needed
            console.log('Processing Discord authentication...');
        }

        function showAuthSuccess(user) {
            console.log('Showing auth success for user:', user);
            
            // Update the user profile in the navigation
            updateUserProfile(user);
            
            // Show success message
            const successMessage = document.createElement('div');
            successMessage.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #1db954;
                color: white;
                padding: 16px 24px;
                border-radius: 8px;
                z-index: 10000;
                font-weight: 600;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            successMessage.innerHTML = `
                <i class="fas fa-check-circle" style="margin-right: 8px;"></i>
                Discord Connected Successfully!
            `;
            document.body.appendChild(successMessage);
            
            // Remove message after 3 seconds
            setTimeout(() => {
                successMessage.remove();
            }, 3000);
        }

        function updateUserProfile(user) {
            console.log('Updating user profile:', user);
            
            const loginBtn = document.getElementById('loginBtn');
            const userProfile = document.getElementById('userProfile');
            const userAvatar = document.getElementById('userAvatar');
            const userDisplayName = document.getElementById('userDisplayName');
            
            if (!loginBtn || !userProfile || !userAvatar || !userDisplayName) {
                console.error('User profile elements not found');
                return;
            }
            
            if (user) {
                // Set user avatar
                if (user.avatar) {
                    userAvatar.src = `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png?size=64`;
                } else {
                    userAvatar.src = `https://cdn.discordapp.com/embed/avatars/${user.discriminator % 5}.png`;
                }
                
                // Set username (use global_name if available, otherwise username)
                userDisplayName.textContent = user.global_name || user.username;
                
                // Show profile, hide login button
                loginBtn.style.display = 'none';
                userProfile.style.display = 'flex';
                
                console.log('User profile updated successfully');
            }
        }

        function showAuthError(error) {
            // Show error message
            const errorMessage = document.createElement('div');
            errorMessage.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #ff4444;
                color: white;
                padding: 16px 24px;
                border-radius: 8px;
                z-index: 10000;
                font-weight: 600;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            errorMessage.innerHTML = `
                <i class="fas fa-exclamation-triangle" style="margin-right: 8px;"></i>
                Authentication Failed: ${error}
            `;
            document.body.appendChild(errorMessage);
            
            // Remove message after 5 seconds
            setTimeout(() => {
                errorMessage.remove();
            }, 5000);
        }
    </script>
</body>
</html>
